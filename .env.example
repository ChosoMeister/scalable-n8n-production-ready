# ==============================================================================
#                         n8n Production Environment
# ==============================================================================
# Copy this file to .env and update the values
# Or run ./setup.sh to generate secure values automatically

# ==============================================================================
#                              CREDENTIALS
# ==============================================================================
# IMPORTANT: Generate secure values using:
#   openssl rand -base64 24  # For passwords
#   openssl rand -hex 32     # For encryption key

# Database
POSTGRES_USER=n8n_user
POSTGRES_PASSWORD=CHANGE_ME_DB_PASSWORD
POSTGRES_DB=n8n

# Redis
REDIS_PASSWORD=CHANGE_ME_REDIS_PASSWORD

# n8n Encryption (MUST be unique and kept secret)
N8N_ENCRYPTION_KEY=CHANGE_ME_ENCRYPTION_KEY

# ==============================================================================
#                              DATABASE
# ==============================================================================
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
DATABASE_URL=postgres://n8n_user:CHANGE_ME_DB_PASSWORD@postgres:5432/n8n

# n8n Database Connection (via PgBouncer)
DB_TYPE=postgresdb
DB_POSTGRESDB_HOST=pgbouncer
DB_POSTGRESDB_PORT=6432
DB_POSTGRESDB_DATABASE=n8n
DB_POSTGRESDB_USER=n8n_user
DB_POSTGRESDB_PASSWORD=CHANGE_ME_DB_PASSWORD

# ==============================================================================
#                              PGBOUNCER
# ==============================================================================
PGBOUNCER_LISTEN_PORT=6432
PGBOUNCER_LISTEN_ADDR=0.0.0.0
PGBOUNCER_AUTH_TYPE=md5
PGBOUNCER_AUTH_FILE=/etc/pgbouncer/userlist.txt
PGBOUNCER_MAX_CLIENT_CONN=1000
PGBOUNCER_POOL_MODE=transaction
PGBOUNCER_DEFAULT_POOL_SIZE=50
PGBOUNCER_MIN_POOL_SIZE=5
PGBOUNCER_RESERVE_POOL_SIZE=20
PGBOUNCER_RESERVE_POOL_TIMEOUT=5

# ==============================================================================
#                              REDIS / QUEUE
# ==============================================================================
EXECUTIONS_MODE=queue
QUEUE_BULL_REDIS_HOST=redis
QUEUE_BULL_REDIS_PASSWORD=CHANGE_ME_REDIS_PASSWORD
QUEUE_HEALTH_CHECK_ACTIVE=true

# ==============================================================================
#                              N8N SETTINGS
# ==============================================================================
NODE_ENV=production

# URLs - UPDATE THESE FOR YOUR DOMAIN
N8N_HOST=n8n.yourdomain.com
N8N_PORT=5678
N8N_PROTOCOL=https
N8N_EDITOR_BASE_URL=https://n8n.yourdomain.com
WEBHOOK_URL=https://n8n-webhook.yourdomain.com

# Security
N8N_ENFORCE_SETTINGS_FILE_PERMISSIONS=true
N8N_BLOCK_ENV_ACCESS_IN_NODE=true
N8N_DISABLE_PRODUCTION_MAIN_PROCESS=true
N8N_SECURE_COOKIE=true

# Task Runners (for Code nodes)
N8N_RUNNERS_ENABLED=true
N8N_RUNNERS_MODE=internal

# Execution Settings
EXECUTIONS_TIMEOUT=3600
EXECUTIONS_DATA_SAVE_ON_ERROR=all
EXECUTIONS_DATA_SAVE_ON_SUCCESS=all
EXECUTIONS_DATA_SAVE_MANUAL_EXECUTIONS=true
EXECUTIONS_DATA_PRUNE=true
EXECUTIONS_DATA_MAX_AGE=168

# Timezone
GENERIC_TIMEZONE=Asia/Tehran
TZ=Asia/Tehran
